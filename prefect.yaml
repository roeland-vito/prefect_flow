name: cams-ncp-pipeline
prefect-version: 3.4.0

# No build steps needed (environment setup is handled in the command)
build: null

pull:
  - prefect.deployments.steps.git_clone:
      id: clone-repo
      repository: https://github.com/roeland-vito/prefect_flow.git
      #repository: https://git.vito.be/scm/tes/cams-ncp_flow_process.git
      branch: main

#  - prefect.deployments.steps.run_shell_script:
#      id: ls
#      directory: "{{ clone-step.directory }}"
#      script: ls -lisat
#      stream_output: true
      
  - vito.sas_prefect.uv_install:
      id: uv-install-step
      directory: "{{ clone-step.directory }}" # `clone-step` is a user-provided `id` field
      min_python_version: "3.10"
      sub_directory: prefect_flow-main
      stream_output: true
              
deployments:
- name: cams-ncp-hourly
  version: null
  tags:
    - cams
  description: "Hourly CAMS NCP data download pipeline"
  concurrency_limit: null
  entrypoint: cams_ncp_pipeline.py:main
  parameters: {}
  work_pool:
    name: test-docker-process-worker
    job_variables:
      # Explicitly use uv
      command: "uv run python -m prefect.engine"
  schedule:
    cron: "0 * * * *"  # Run hourly at minute 0
    timezone: UTC